<h1 class="page-title">Lab 10: Smart Pot Project</h1>
<p class="page-subtitle">Complete IoT system for plant environment control</p>

<div class="lab-content">
    <div class="lab-section learning-goals">
        <h2 class="lab-section-title">Learning Goals</h2>
        <div class="card">
            <p>The overall objective of this project is to develop a smart pot as a small-scale controlled environment system for a plant to detect various environmental factors and make decisions to achieve the desired environment for the plant to grow. The IoT system includes multiple sensors and actuators that will interact with the plant. The sensing part comprises temperature and relative humidity, PAR, and soil moisture sensors. The actuators are a servo motor, an irrigation pump, an LED, and a lamp.</p>
            
            <p>The learning goal is to learn and practice:</p>
            <ul>
                <li>Creating scripts and functions in Blockly</li>
                <li>How to read data from multiple sensors</li>
                <li>How to make decisions based on sensors' data and user-defined values (set points)</li>
                <li>How to activate and control multiple actuators</li>
            </ul>
        </div>
    </div>

    <div class="lab-section materials">
        <h2 class="lab-section-title">Software and Hardware</h2>
        <div class="card">
            <ul>
                <li>BlocklyProp Solo</li>
                <li>Activity Board and Parallax USB programming cable</li>
                <li>PAR sensor</li>
                <li>Temperature/RH sensor</li>
                <li>Soil moisture sensor</li>
                <li>Servo motor</li>
                <li>Pump (peristaltic pump)</li>
                <li>Outlet Power Relay Module</li>
            </ul>
        </div>
    </div>

    <div class="lab-section">
        <h2 class="lab-section-title">Project Description</h2>
        <div class="card">
            <p>This project provides the opportunity to integrate several assignments we have been working on during the quarter. To control and achieve the desired growth environment for plants, we need to develop a program that prompts users to enter the desired values (set points or thresholds) for each parameter we will control. Additionally, it should constantly read the sensor data. Then, it should activate the actuators based on the input data from the users and sensors.</p>
            
            <p><strong>Workflow:</strong> Measuring a physical quantity → Decision making → Acting based on the decision</p>
            
            <img src="assets/images/learning-modules/Lab_10/image1.png" alt="Figure 1. The workflow of the smart pot from sensing to acting" class="lab-image">
        </div>
    </div>

    <div class="lab-section">
        <h2 class="lab-section-title">Programming Structure</h2>
        <div class="card">
            <p>The code includes a main block and eight function blocks as follows:</p>
            
            <h4>Main Block:</h4>
            <ul>
                <li>Define a variable called "iteration" and set it to 1</li>
                <li>Get set points from users and save them as variables:
                    <ul>
                        <li>Temperature set point (threshold) saved as "temp_threshold"</li>
                        <li>Relative humidity set point saved as "rh_threshold"</li>
                        <li>PAR set point saved as "par_threshold"</li>
                        <li>Soil moisture set point saved as "moisture_threshold"</li>
                    </ul>
                </li>
                <li>A forever repeat block:
                    <ul>
                        <li>Print the iteration variable to show how many measurements we have done so far</li>
                        <li>Call functions:
                            <ul>
                                <li><strong>temp_sensor</strong> function to read the temperature value</li>
                                <li><strong>rh_sensor</strong> function to read the RH value</li>
                                <li><strong>par_sensor</strong> function to read the intensity of ambient light</li>
                                <li><strong>moisture_sensor</strong> function to read the soil moisture</li>
                                <li><strong>led_light</strong> function to turn on LED 26 based on temperature</li>
                                <li><strong>servo_motor</strong> function to rotate servo motor based on RH</li>
                                <li><strong>light_source</strong> function to turn the light source ON and OFF based on PAR</li>
                                <li><strong>irrigation_pump</strong> function to turn the pump ON and OFF based on soil moisture</li>
                            </ul>
                        </li>
                        <li>Pause 3000 ms</li>
                        <li>Increment iteration variable</li>
                        <li>Clear the terminal</li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>

    <div class="lab-section">
        <h2 class="lab-section-title">Control Logic</h2>
        <div class="card">
            <table>
                <thead>
                    <tr>
                        <th>Condition</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Temperature > threshold defined by users</td>
                        <td>Turn on the LED connected to pin 26, assuming we are turning a fan ON. Otherwise, turn off the LED light.</td>
                    </tr>
                    <tr>
                        <td>Relative humidity > threshold defined by users</td>
                        <td>Rotate the servo motor 90 degrees, assuming the motor is opening a window in a greenhouse. Otherwise, set the angle to 0 degrees (closing the gate).</td>
                    </tr>
                    <tr>
                        <td>Soil moisture < threshold defined by users</td>
                        <td>Turn on the pump until the soil moisture returns to the desired level. The pump is connected to "relay 1". Otherwise, turn off the pump.</td>
                    </tr>
                    <tr>
                        <td>PAR < threshold defined by users</td>
                        <td>Turn on the light source until the light intensity gets back to the desired level. The light source is connected to "relay 2". Otherwise, turn off the light source.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="lab-section">
        <h2 class="lab-section-title">Pin Assignments</h2>
        <div class="card">
            <table>
                <thead>
                    <tr>
                        <th>Sensor/Actuator</th>
                        <th>Pin</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Temp/RH sensor</td>
                        <td>Pin 14</td>
                    </tr>
                    <tr>
                        <td>Soil moisture sensor connected to the general socket</td>
                        <td>Pin AD2 (analog to digital 2)</td>
                    </tr>
                    <tr>
                        <td>PAR sensor</td>
                        <td>Pin AD3 (analog to digital 3)</td>
                    </tr>
                    <tr>
                        <td>The Servo motor is connected to one of the top servo's pins</td>
                        <td>Pin 16 and 17, as we did for lab 7</td>
                    </tr>
                    <tr>
                        <td>The pump is plugged into the relay module that is connected to the "relay 1" socket</td>
                        <td>Pin 13</td>
                    </tr>
                    <tr>
                        <td>The light source is plugged into the relay module that is connected to "relay 2" socket</td>
                        <td>Pin 12</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="lab-section">
        <h2 class="lab-section-title">What to Submit</h2>
        <div class="card">
            <ul>
                <li>Submit your code saved as a <strong>*.svg file</strong></li>
                <li>A photo of your system</li>
                <li>A short video of your system while working (OPTIONAL)</li>
            </ul>
            
            <p><strong>Naming:</strong> project_firstName_lastName.svg (e.g., project_ali_moghimi.svg)</p>
            
            <h4>Important Notes:</h4>
            <ul>
                <li>The project is worth <strong>20%</strong> of the total course grade</li>
                <li>You can work on your project during our last lab session in week 10</li>
                <li>Please submit your project by June 7th</li>
                <li>You need to return all the equipment you borrowed by <strong>June 10</strong></li>
            </ul>
        </div>
    </div>
</div>